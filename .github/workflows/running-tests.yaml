name: üèÉ tests

on:
    push:
        branches:
            - '*'
        tags:
            - '*'
    pull_request:
        types: [ opened, edited ]
    schedule:
        -   cron: '*/42 4 * * *'


env:
    typo3DatabaseHost: localhost
    typo3DatabaseName: typo3
    typo3DatabaseUsername: root
    typo3DatabasePassword: password

jobs:
    running-tests:
        runs-on: ubuntu-latest
        services:
            mysql:
                image: mysql:5.7
                env:
                    MYSQL_ALLOW_EMPTY_PASSWORD: false
                    MYSQL_DATABASE: typo3
                    MYSQL_ROOT_PASSWORD: password
                ports:
                    - 3306
        strategy:
            fail-fast: false
            matrix:
                php: [ '7.4', '7.3', '7.2' ]
                typo3: [ '^9.5', '^10.4' ]
        steps:
            -   uses: actions/checkout@v2
            -   uses: shivammathur/setup-php@v2
                with:
                    php-version: ${{ matrix.php }}
                    tools: composer:v2
            -   name: install
                run: |
                    composer require --no-progress --no-suggest --no-update nimut/typo3-complete:"${{ matrix.typo3 }}"
                    composer update
                    git checkout composer.json
            -   name: prepare
                run: |
                    mkdir -p .Build/public/typo3conf/ext/
                    if [ ! -L .Build/public/typo3conf/ext/my_skeleton ]; then ln -snvf ../../../../. .Build/public/typo3conf/ext/my_skeleton; fi
                    echo "Hello $typo3DatabaseUsername on $typo3DatabaseHost $typo3DatabaseName $typo3DatabasePassword $typo3DatabasePort !"
